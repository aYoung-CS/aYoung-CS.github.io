<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>aYoung's Blog</title><meta name="author" content="aYoung"><meta name="copyright" content="aYoung"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="aYoung的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="aYoung&#39;s Blog">
<meta property="og:url" content="https://iamayoung.xyz/page/4/index.html">
<meta property="og:site_name" content="aYoung&#39;s Blog">
<meta property="og:description" content="aYoung的博客">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s4.ax1x.com/2022/01/14/731OZF.jpg">
<meta property="article:author" content="aYoung">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s4.ax1x.com/2022/01/14/731OZF.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://iamayoung.xyz/page/4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-11-11 18:10:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://s4.ax1x.com/2022/01/14/731OZF.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://vkceyugu.cdn.bspapp.com/VKCEYUGU-imgbed/be522a3f-c644-4f9f-acdd-ea04bcdab54c.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">aYoung's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">aYoung's Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/aYoung-CS" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/07/28/House-of-Orange/" title="House_of_Orange">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/07/4240c846ca572854.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="House_of_Orange"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/28/House-of-Orange/" title="House_of_Orange">House_of_Orange</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-28T05:45:01.000Z" title="发表于 2021-07-28 13:45:01">2021-07-28</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/heap/">heap</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/IO-FILE/">IO_FILE</a></span></div><div class="content">House of Orange方法适用于glibc2.23house of orange主要分为两个部分，首先是创造出unsorted bin，然后利用unsorted bin attack修改_IO_list_all指向可控的heap，最后伪造数据FSOP getshell以下以how2heap中的house of orange为例
创造unsorted binmalloc(0x400-16)假设存在溢出，修改top chunk的size需要满足两个条件：Top chunk + size页对齐和pre_inuse位为1示例中top chunk大小为0x20c01，修改为0xc01
接下来malloc(0x1000)由于此时top chunk的大小仅为0xc01会调用sysmalooc，效果就是旧的top chunk被放入unsorted bin中，heap也进行了brk拓展，且紧跟在原本的top chunk之后
10x602000           0x623000 rw-p    21000 0      [heap]
拓展后如下10x602000           0x645 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/07/26/FSOP/" title="FSOP">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/06/373b822d88c4973e.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FSOP"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/26/FSOP/" title="FSOP">FSOP</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-26T09:32:32.000Z" title="发表于 2021-07-26 17:32:32">2021-07-26</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/IO-FILE/">IO_FILE</a></span></div><div class="content">FSOPFile Stream Oriented Programming
基础知识IO-FILE基础
原理glibc中有一个函数_IO_flush_all_lockp，功能是刷新所有FILE结构体的输出缓冲区。源码在libio\genops中https://elixir.bootlin.com/glibc/glibc-2.23/source/libio/genops.c
123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354int_IO_flush_all_lockp (int do_lock)&#123;  int result = 0;  struct _IO_FILE *fp;  int last_stamp;#ifdef _IO_MTSAFE_IO  __libc_cleanup_region_start (do_lock, flush_cleanup, NULL);  if (do_lock)    _IO_lock_lock (li ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/07/25/%E5%88%9D%E8%AF%86IO-FILE/" title="初识IO-FILE">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/06/373b822d88c4973e.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="初识IO-FILE"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/25/%E5%88%9D%E8%AF%86IO-FILE/" title="初识IO-FILE">初识IO-FILE</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-25T14:54:33.000Z" title="发表于 2021-07-25 22:54:33">2021-07-25</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/IO-FILE/">IO-FILE</a></span></div><div class="content">IO_FILE结构IO_FILE在Linux系统的标准IO库中是用于描述文件的结构，称为文件流。FILE结构在程序执行fopen等函数时会进行创建，并分配在堆中，进程中的FILE结构通过_chain域彼此连接形成一个链表。在标准I/O库中，每个程序启动时有三个文件流是自动打开的：stdin、stdout、stderr，在libc.so的数据段上。在libc-2.23版本中，有个局部变量_IO_list_all，该变量指向了FILE链表的头部。_IO_FILE外包裹着另一种结构体_IO_FILE_plus，其中重要指针vtable指向一系列函数指针。libc2.23下，32位的vtable偏移0x94，64位偏移0xd8。_IO_FILE_plus结构体如下代码所示，其中有包括了两个重要的结构体_IO_FILE和IO_jump_t
12345struct _IO_FILE_plus&#123;    _IO_FILE    file;    _IO_jump_t   *vtable;&#125;
其中_IO_FILE结构体如下1234567891011121314151617181920 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/07/14/House-of-Rabbit/" title="House_of_Rabbit">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/07/4240c846ca572854.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="House_of_Rabbit"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/14/House-of-Rabbit/" title="House_of_Rabbit">House_of_Rabbit</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-14T02:06:32.000Z" title="发表于 2021-07-14 10:06:32">2021-07-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/heap/">heap</a></span></div><div class="content">House of Rabbit一种针对fastbin的攻击，造成chunk overlap。当glibc版本大于2.26时需要先绕过tcache
核心原理glibc-2.23当malloc一个很大的chunk时（large bin范围），会检查是否存在fastbin，若存在则触发malloc_consolidate1234567891011121314151617/*       If this is a large request, consolidate fastbins before continuing.       While it might look excessive to kill all fastbins before       even seeing if there is space available, this avoids       fragmentation problems normally associated with fastbins.       Also, in practice, programs tend to have runs o ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/07/10/how2heap%E4%B9%8BHouse_of_Roman/" title="how2heap之House_of_Roman">     <img class="post_bg" src="https://ae01.alicdn.com/kf/U01d4ba5a6f0a460496eb5cc2ca9599b7E.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="how2heap之House_of_Roman"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/10/how2heap%E4%B9%8BHouse_of_Roman/" title="how2heap之House_of_Roman">how2heap之House_of_Roman</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-10T04:33:41.000Z" title="发表于 2021-07-10 12:33:41">2021-07-10</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/how2heap/">how2heap</a></span></div><div class="content">House of Roman总结一句话就是fastbin attack+unsorted bin attack+brute force该方法不需要泄露libc地址，partial overwrite写onegadget或者system撞大运（1/4096）
step 1Fastbin Chunk points to __malloc_hook
这里的fastbin attack利用了堆块的布局，结合off_by_one构造fastbin链，值得关注
1fastbin_victim 0x71chunk 0x91main_arena_use 0x91relative_offset_heap 0x71Top chunk
2free(main_arena_use)unsortedbin main_arena_use 0x91
3malloc(0x60)
fastbin_victim 0x71chunk 0x91fake_libc_chunk 0x71unsorted bin 0x21relative_offset_heap 0x71Top chunk
4free(relative_offset ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/07/06/%E3%80%90WP%E3%80%91%E5%A8%B1%E4%B9%90%E8%B5%9Bawd%E7%9A%84%E4%B8%80%E9%81%93pwn%E9%A2%98/" title="【WP】娱乐赛awd的一道pwn题">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】娱乐赛awd的一道pwn题"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/06/%E3%80%90WP%E3%80%91%E5%A8%B1%E4%B9%90%E8%B5%9Bawd%E7%9A%84%E4%B8%80%E9%81%93pwn%E9%A2%98/" title="【WP】娱乐赛awd的一道pwn题">【WP】娱乐赛awd的一道pwn题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-06T14:22:05.000Z" title="发表于 2021-07-06 22:22:05">2021-07-06</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/wp/">wp</a></span></div><div class="content">题目开局一个菜单一开始循环一次就会执行exit退出
encode112345678910111213141516171819202122232425262728293031323334353637383940unsigned __int64 encode1()&#123;  unsigned int v1; // [rsp+8h] [rbp-38h]  unsigned int v2; // [rsp+Ch] [rbp-34h]  char buf[40]; // [rsp+10h] [rbp-30h] BYREF  unsigned __int64 v4; // [rsp+38h] [rbp-8h]  v4 = __readfsqword(0x28u);  puts(&quot;==========encode1==========&quot;);  puts(&quot;keys?&quot;);  v1 = read(0, buf, 0x20uLL);  printf(&quot;Your key:%s&quot;, buf);  puts(&quot;your message  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/07/04/%E3%80%90WP%E3%80%91%E5%BC%BA%E7%BD%91%E6%9D%AF%E4%B9%8Borw/" title="【WP】强网杯之orw">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】强网杯之orw"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/07/04/%E3%80%90WP%E3%80%91%E5%BC%BA%E7%BD%91%E6%9D%AF%E4%B9%8Borw/" title="【WP】强网杯之orw">【WP】强网杯之orw</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-04T13:26:28.000Z" title="发表于 2021-07-04 21:26:28">2021-07-04</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/wp/">wp</a></span></div><div class="content">题目开了沙盒开了PIE Canary，没开nx

add1234567891011121314151617181920212223242526__int64 sub_E44()&#123;  int v1; // [rsp+0h] [rbp-10h]  int v2; // [rsp+4h] [rbp-Ch]  if ( qword_202130 &lt;= 1 )  &#123;    puts(&quot;index:&quot;);    v1 = read_int();    puts(&quot;size:&quot;);    v2 = read_int();    if ( v2 &gt;= 0 &amp;&amp; v2 &lt;= 8 &amp;&amp; v1 &lt;= 1 )    &#123;      qword_2020E0[v1] = malloc(v2);      if ( !qword_2020E0[v1] )      &#123;        puts(&quot;error&quot;);        exit(0);      &#12 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/06/10/%E3%80%90WP%E3%80%91%E9%99%90%E5%88%B6%E4%B8%AA%E6%95%B0%E5%92%8C%E5%A4%A7%E5%B0%8F%E7%9A%84Null-Byte%E6%BA%A2%E5%87%BA/" title="【WP】限制个数和大小的Null-Byte溢出">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】限制个数和大小的Null-Byte溢出"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/06/10/%E3%80%90WP%E3%80%91%E9%99%90%E5%88%B6%E4%B8%AA%E6%95%B0%E5%92%8C%E5%A4%A7%E5%B0%8F%E7%9A%84Null-Byte%E6%BA%A2%E5%87%BA/" title="【WP】限制个数和大小的Null-Byte溢出">【WP】限制个数和大小的Null-Byte溢出</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-06-10T11:29:11.000Z" title="发表于 2021-06-10 19:29:11">2021-06-10</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/wp/">wp</a></span></div><div class="content">2021津门杯 pwn2null byte 溢出
题目描述creat最多创建十个chunk申请的chunk最大不超过496=0x1f0
输入0xa字节的topic name输入des size申请相应大小的chunk，指针记录在bss段
先用read读入相应size字节到栈上然后用strcpy存到chunk中
而strcpy会复制截断字符\x00所以这里存在null byte溢出
deletefree chunk指针并置0所有记录在bss段的信息清零
show把信息都打印出来
思路还是利用传统的null byte方法创造出堆块重叠利用埋在其中的两个chunk分别泄露地址和tcache poisoning
操作这道题比较复杂的地方在于个数的限制，需要不断申请释放相应大小的chunk填满tcache同时大小的限制也让unsorted bin没有那么直接的出现还有strcpy的填入方式需要小小改变一下填入数据的方式
先把0x90的tcache填满
布置好chunk申请10个0x108大小的chunk这个大小的chunk可以溢出到下一个chunk的size位同时当相应大小的tcache被填满后 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2021/06/08/%E3%80%90WP%E3%80%91%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%8D%8A%E5%86%B3%E8%B5%9Bpwn%E9%A2%98/" title="【WP】蓝帽杯2021半决赛pwn题">     <img class="post_bg" src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】蓝帽杯2021半决赛pwn题"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/06/08/%E3%80%90WP%E3%80%91%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%8D%8A%E5%86%B3%E8%B5%9Bpwn%E9%A2%98/" title="【WP】蓝帽杯2021半决赛pwn题">【WP】蓝帽杯2021半决赛pwn题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-06-08T15:52:29.000Z" title="发表于 2021-06-08 23:52:29">2021-06-08</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/wp/">wp</a></span></div><div class="content">呃这次比赛呢感觉打的不是很好，主要还是菜，格式化字符串的题一开始思路想歪了，做成了在bss段的打法，导致后来时间都花在了调试上，最后在本地调到了差半个字节但是远程一直EOF……
cover题目1234567891011121314151617181920212223242526272829int __cdecl main()&#123;  _BYTE *buf; // [esp+18h] [ebp-20h] BYREF  int n; // [esp+1Ch] [ebp-1Ch]  int v3; // [esp+20h] [ebp-18h]  int v4; // [esp+24h] [ebp-14h]  int v5; // [esp+28h] [ebp-10h]  unsigned int v6; // [esp+2Ch] [ebp-Ch]  v6 = __readgsdword(0x14u);  sub_804862B();  buf = 0;  n = 0;  v3 = 0;  v4 = 0;  v5 = 0;  printf(&quot;Try use a bullet t ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2021/06/07/how2heap%E4%B9%8BHouse-of-Einherjar/" title="how2heap之House-of-Einherjar">     <img class="post_bg" src="https://ae01.alicdn.com/kf/U01d4ba5a6f0a460496eb5cc2ca9599b7E.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="how2heap之House-of-Einherjar"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/06/07/how2heap%E4%B9%8BHouse-of-Einherjar/" title="how2heap之House-of-Einherjar">how2heap之House-of-Einherjar</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-06-07T08:59:04.000Z" title="发表于 2021-06-07 16:59:04">2021-06-07</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/ctf/">ctf</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ctf/">ctf</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/pwn/">pwn</a><span class="article-meta__link">•</span><a class="article-meta__tags" href="/tags/how2heap/">how2heap</a></span></div><div class="content">House of Einherjar需要的漏洞off by one控制pre_size和pre_inuse
原理利用free函数的后向合并1234567/* consolidate backward */if (!prev_inuse(p)) &#123;    prevsize = prev_size(p);    size += prevsize;    p = chunk_at_offset(p, -((long) prevsize));    unlink(av, p, bck, fwd);&#125;可以看到，发生后向合并时是根据pre_inuse决定是否发生合并，由presize决定上一个chunk的位置
示例代码glibc2.23123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/3/"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://s4.ax1x.com/2022/01/14/731OZF.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">aYoung</div><div class="author-info__description">aYoung的博客</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/aYoung-CS"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/aYoung-CS" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">好好学习</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/%E3%80%90WP%E3%80%91%E8%93%9D%E5%B8%BD%E6%9D%AF2022-final/" title="【WP】蓝帽杯2022_final"><img src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】蓝帽杯2022_final"/></a><div class="content"><a class="title" href="/2022/09/21/%E3%80%90WP%E3%80%91%E8%93%9D%E5%B8%BD%E6%9D%AF2022-final/" title="【WP】蓝帽杯2022_final">【WP】蓝帽杯2022_final</a><time datetime="2022-09-21T12:27:44.000Z" title="发表于 2022-09-21 20:27:44">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/07/%E3%80%90WP%E3%80%91Ethernaut/" title="【WP】Ethernaut"><img src="https://ftp.bmp.ovh/imgs/2020/12/7359e568759eebbb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】Ethernaut"/></a><div class="content"><a class="title" href="/2022/09/07/%E3%80%90WP%E3%80%91Ethernaut/" title="【WP】Ethernaut">【WP】Ethernaut</a><time datetime="2022-09-07T06:46:53.000Z" title="发表于 2022-09-07 14:46:53">2022-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/26/%E3%80%90WP%E3%80%91qwb2022-final-rdp/" title="【WP】qwb2022_final_rdp"><img src="https://s1.ax1x.com/2022/08/27/vR8Hv6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】qwb2022_final_rdp"/></a><div class="content"><a class="title" href="/2022/08/26/%E3%80%90WP%E3%80%91qwb2022-final-rdp/" title="【WP】qwb2022_final_rdp">【WP】qwb2022_final_rdp</a><time datetime="2022-08-25T16:11:41.000Z" title="发表于 2022-08-26 00:11:41">2022-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/09/%E3%80%90WP%E3%80%91%E8%AE%B0%E5%BD%95%E4%B8%80%E9%81%93jerryscript%E5%BC%95%E6%93%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="【WP】记录一道jerryscript引擎漏洞利用"><img src="https://ftp.bmp.ovh/imgs/2021/02/ec5ef65c96792f29.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【WP】记录一道jerryscript引擎漏洞利用"/></a><div class="content"><a class="title" href="/2022/08/09/%E3%80%90WP%E3%80%91%E8%AE%B0%E5%BD%95%E4%B8%80%E9%81%93jerryscript%E5%BC%95%E6%93%8E%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="【WP】记录一道jerryscript引擎漏洞利用">【WP】记录一道jerryscript引擎漏洞利用</a><time datetime="2022-08-09T15:36:48.000Z" title="发表于 2022-08-09 23:36:48">2022-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/09/PowerPC-PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="PowerPC_PWN从入门到实践"><img src="https://s1.ax1x.com/2022/08/09/v18HoT.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PowerPC_PWN从入门到实践"/></a><div class="content"><a class="title" href="/2022/08/09/PowerPC-PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="PowerPC_PWN从入门到实践">PowerPC_PWN从入门到实践</a><time datetime="2022-08-09T11:14:43.000Z" title="发表于 2022-08-09 19:14:43">2022-08-09</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/ctf/"><span class="card-category-list-name">ctf</span><span class="card-category-list-count">77</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/python/"><span class="card-category-list-name">python</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/ARM/" style="font-size: 1.1em; color: #999">ARM</a> <a href="/tags/IO-FILE/" style="font-size: 1.1em; color: #999">IO-FILE</a> <a href="/tags/IO-FILE/" style="font-size: 1.17em; color: #999c9f">IO_FILE</a> <a href="/tags/ROP/" style="font-size: 1.23em; color: #999ea6">ROP</a> <a href="/tags/blockchain/" style="font-size: 1.1em; color: #999">blockchain</a> <a href="/tags/ctf/" style="font-size: 1.5em; color: #99a9bf">ctf</a> <a href="/tags/heap/" style="font-size: 1.23em; color: #999ea6">heap</a> <a href="/tags/how2heap/" style="font-size: 1.3em; color: #99a1ac">how2heap</a> <a href="/tags/kernel/" style="font-size: 1.23em; color: #999ea6">kernel</a> <a href="/tags/llvm/" style="font-size: 1.1em; color: #999">llvm</a> <a href="/tags/ppc/" style="font-size: 1.1em; color: #999">ppc</a> <a href="/tags/pwn/" style="font-size: 1.43em; color: #99a6b9">pwn</a> <a href="/tags/pwn/" style="font-size: 1.1em; color: #999">pwn'</a> <a href="/tags/python/" style="font-size: 1.17em; color: #999c9f">python</a> <a href="/tags/realworld/" style="font-size: 1.1em; color: #999">realworld</a> <a href="/tags/vmpwn/" style="font-size: 1.1em; color: #999">vmpwn</a> <a href="/tags/wp/" style="font-size: 1.37em; color: #99a4b2">wp</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">八月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/05/"><span class="card-archive-list-date">五月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/04/"><span class="card-archive-list-date">四月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">80</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">166.4k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-11-11T10:10:36.304Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By aYoung</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    var typed = new Typed("#subtitle", {
      strings: "敏于事&#44;慎于言,speedy as a worker and cautious as a speaker".split(","),
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '敏于事&#44;慎于言'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>